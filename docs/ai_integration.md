# AI-–º–æ–¥—É–ª—å "–ì–¥–µ–ú–æ—ë"

## –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
1. –ö–ª–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ ‚Üí backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–µ–¥–∏–∞, —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å `media`.
2. Backend –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/v1/ai/analyze` —Å `media_id`.
3. Backend —Å–æ–∑–¥–∞—ë—Ç `aidetection` (status=pending) –∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤–æ –≤–Ω–µ—à–Ω–∏–π AI —Å–µ—Ä–≤–∏—Å.
4. AI —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∞–π–ª, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç callback –∏–ª–∏ backend –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –µ–≥–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç `aidetection` + `aidetectionobject` + `aidetectioncandidate`.
5. –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–ù–∞–¥–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å" –∏/–∏–ª–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

## –ö–æ–Ω—Ç—Ä–∞–∫—Ç FastAPI ‚Üí AI —Å–µ—Ä–≤–∏—Å (–ø—Ä–∏–º–µ—Ä)
- **POST {AI_SERVICE_URL}/tasks**
```json
{
  "media_id": 123,
  "callback_id": 45,
  "file_path": "/data/gdemo/media/1/1/123/original.jpg"
}
```
–û—Ç–≤–µ—Ç: `{"task_id": "abc-123"}`.

- **POST {backend}/api/v1/ai/callback** (AI –≤—ã–∑—ã–≤–∞–µ—Ç backend)
```json
{
  "callback_id": 45,
  "objects": [
    {
      "label": "–ü–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä Bosch",
      "confidence": 0.92,
      "bbox": {"x":0.1,"y":0.2,"w":0.4,"h":0.5},
      "candidates": [
        {"item_id": 12, "score": 0.83},
        {"item_id": 37, "score": 0.55}
      ],
      "suggested_location_id": 8
    }
  ]
}
```
Backend:
- –æ–±–Ω–æ–≤–ª—è–µ—Ç `aidetection.status=done`,
- —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã –∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤,
- –ø—Ä–∏ `candidates` –ø—É—Å—Ç—ã—Ö —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `needs_review`.

## –ü—Ä–æ—Ç–æ—Ç–∏–ø—ã –≤ –∫–æ–¥–µ
- `backend/app/api/routes/ai.py` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∞–Ω–∞–ª–∏–∑–∞.
- `backend/app/models/ai.py` ‚Äî —Ç–∞–±–ª–∏—Ü—ã `aidetection`, `aidetectionobject`, `aidetectioncandidate`.
- `backend/app/schemas/ai.py` ‚Äî —Å—Ö–µ–º—ã –æ—Ç–≤–µ—Ç–æ–≤.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ AI
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ (YOLOv8/Segment Anything) + —Ç–µ–∫—Å—Ç–æ–≤—ã–π —ç–Ω–∫–æ–¥–µ—Ä –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏.
- –•—Ä–∞–Ω–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ –∫—ç—à–µ (Redis/PG vector) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫.
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É: –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á, –º–∞–∫—Å–∏–º—É–º N –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–æ–∫.
- –î–ª—è –≤–∏–¥–µ–æ: –∏–∑–≤–ª–µ–∫–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ –∫–∞–¥—Ä—ã, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

????? API ??? AI-???????:
- GET /api/v1/ai/detections?status=pending|done ó ?????? ????????.
- POST /api/v1/ai/detections/{id}/accept {item_id?, location_id?}
- POST /api/v1/ai/detections/{id}/reject {item_id?, location_id?}
- POST /api/v1/ai/detections/{id}/review_log {action, payload}
??????: ????? upload ???????? /ai/analyze, ????? ?????? /ai/detections ? ????? ??????? ? /review_log.
