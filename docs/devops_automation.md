# DevOps ? ?????????????

## ????
- ?????????? ?????? ?? NAS/???????? ??? ???????? ????????.
- ??????? smoke-???? API ????? ??????.
- ???????? ?? ?????????? AI (????, ???????????), ?? ? ?????-?????????.

## ???? ? ?????????????
- **??????? ? ??????**: ??????? CIFS ????? (`NAS_USER`, `NAS_PASSWORD`) ? JWT ????? ? `.env`/??????? CI; ? `docker-compose.yml` ????????? ?? ??????????. ?? ????????? ???????? ??????.
- **Health checks**:
  - API: `/api/v1/health` (???????) ? `/api/v1/health/full` (db + ?????-???? + YOLO ????).
  - Docker: healthcheck ??? `api` ? `db` ? `backend/docker/docker-compose.yml`.
- **CI/CD** (GitHub Actions):
  - backend: `python -m pytest`.
  - mobile: `./gradlew testDebugUnitTest`.
  - ?????????: ??? ????????????? ???????? APK ? ???????.
- **??????**:
  - ?????? `scripts/deploy_nas.sh`: `docker compose up -d --build`, `alembic upgrade head`, ???????? health.
  - ????? ???????????? ????????? ????????? ????? ?? NAS ? ????? ?? ????????.
- **AI ????**:
  - `AI_YOLO_WEIGHTS_PATH` ? compose ????????? ?? `/root/.cache/ultralytics/assets/yolov8n.pt`.
  - ??? ???????? ????????? ???? ??????? ??? ???????????? fallback.
- **????????? ?????**:
  - `VIDEO_FRAME_STRIDE` ? `VIDEO_MAX_FRAMES` ???????? ????? `.env` ? form-????????? upload.
- **?????????????**:
  - ???? ??????? ???????? ? `/api/v1/logs`; ???????? ???????/??????? ?????.
  - ???????: ????? ???????? ?????, ???? failed AI; ????? ?????? ? ????? ? ???????? Prometheus ?????.
- **??????**:
  - Postgres: cron `pg_dump` ? ????????? ?? NAS (????????? ??? ?????????????).
  - ?????: ?????? CIFS/rsync ?? ????????? ???; ????????? ?????? ? ????? ??????.

## ??????? smoke-???? ????? ??????
```bash
curl -f http://localhost:8000/api/v1/health
curl -f http://localhost:8000/api/v1/health/full
python - <<'PY'
import requests
base="http://localhost:8000/api/v1"
r=requests.post(f"{base}/media/upload", files={"file": ("ping.txt", b"ping", "text/plain")}, data={"workspace_id":2,"owner_user_id":1,"media_type":"photo","scope":"public","subdir":"smoke","analyze":False})
print("upload status", r.status_code)
print("history", requests.get(f"{base}/media/history?limit=1").json())
PY
```
???? AI ?? ?????? ???????????, ??????? `analyze=false`; ??? ??????? ????? ????? ????????? ????????? JPG ? ????????? `ai_status`.
