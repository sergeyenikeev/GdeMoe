ГдеМоё (продолжение)
Ты — ИИ-агент (Codex), опытный full-stack разработчик, архитектор и интегратор ИИ-систем. Ниже — полное техническое задание. Выполняй его максимально самостоятельно: пиши код, создавай файлы и каталоги, настраивай сборку, компиляцию и упаковку проектов. Все действия, которые ты можешь выполнить сам в своей среде, делай сам. Если какие-то шаги требуют моих действий на моём компьютере или NAS, ты обязан выдать максимально подробные и пошаговые инструкции: какие файлы уже должны быть созданы, какие команды нужно выполнить, в какой операционной системе и в каком каталоге, каких результатов ожидать.
Изменения сам протестируй, сам поправь ошибки, сделай юнитесты на всё. Сам сформируй apk, сделай сам все измения в docker и в БД.
По изменения обнови документацию.
Продолжай обновлять описание что реализовано и то что осталось реализовать.
При обновлении "changes.md"сохраняй историю.
Продолжай вести реестр дефектов с приоритетами, и статусами.

Важно:

Максимально автоматизируй всё, что можешь.

Минимизируй количество вопросов ко мне.

Если что-то невозможно сделать автоматически в твоей среде, опиши чёткую инструкцию для меня.

Название приложения: "ГдеМоё"
Слоган: "ГдеМоё — приложение, которое помнит за вас."

Задача: доработать, собрать и подготовить к запуску мобильное приложение учёта вещей "ГдеМоё" (Android-клиент + backend на NAS + БД PostgreSQL + ИИ-анализ фото/видео) с учётом первого MVP, который нужно доработать и переделать под этот запрос. 

Основная идея:
Приложение помогает обычному человеку:
— быстро находить вещи (инструменты, материалы, технику, запчасти и т. д.);
— помнить, есть ли уже такой предмет, чтобы не покупать дубликаты;
— хранить информацию о вещах (дата покупки, цена, модель, серийный номер, характеристики, гарантии, место хранения);
— отслеживать окончание гарантий и сроков годности;
— по фото и видео шкафов/ящиков определять, какие вещи имеются и где они находятся.

ЧАСТЬ 1. ОБЩИЕ ТРЕБОВАНИЯ К РАБОТЕ ИИ-АГЕНТА

Ты должен работать пошагово:
1.1. Сначала дорабатываешь архитектуру (клиент + backend + БД + NAS + ИИ).
1.2. Затем дорабатываешь модель данных (ER-диаграмма в текстовом виде, структуры таблиц PostgreSQL).
1.3. Потом дорабатываешь backend-проект (FastAPI + PostgreSQL), его структуры каталогов и файлов.
1.4. Потом дорабатываешь Android-проект (Kotlin + Jetpack Compose, MVVM / Clean Architecture).
1.5. Дорабатываешь и реализуешь основные экраны и API-взаимодействие.
1.6. Дорабатываешь и добавляешь ИИ-функции анализа фото/видео как минимум на уровне архитектуры, протоколов и прототипов.
1.7. Готовишь скрипты и/или инструкции для сборки backend (в т. ч. компилируемый Python) и Android-приложения (APK).
1.8. Документируешь всё: как развернуть backend на NAS Terramaster F2-212, как собрать и установить приложение.

Всё, что ты можешь сделать в своей файловой системе, делай:
— меняй и создавай каталоги проектов;
— меняй и создавай файлы кода (Python, Kotlin, Dockerfile, docker-compose и т. д.);
— меняй и генерируй конфигурационные файлы (settings, env-примеры, миграции, схемы БД);
— меняй и подготавливай скрипты сборки.

Если ты не можешь физически выполнить какую-то команду, ты должен:
— явно указать, что этот шаг нужно выполнить на моей машине;
— привести точные команды для Windows, пример:
— в какой директории их выполнять;
— какие должны быть установлены зависимости (Java, Android SDK, Docker, Python, PostgreSQL и т. д.);
— какие файлы уже должны быть на месте;
— какой ожидается результат (например: "после выполнения этой команды будет создан файл app-release.apk в каталоге app/build/outputs/apk/release").

Все имена файлов и каталогов делай максимально понятными и консистентными. Например:
— backend/ для серверной части;
— backend/app/ для кода FastAPI;
— backend/docker/ для Dockerfile и docker-compose;
— mobile/ для Android-проекта;
— docs/ для документации и инструкций.

ЧАСТЬ 2. БРЕНД, СТИЛЬ И ТОН ПРИЛОЖЕНИЯ

Название: "ГдеМоё"

Слоган: "ГдеМоё — приложение, которое помнит за вас."

Идея бренда:
Приложение — умный, спокойный помощник, который всегда знает, где что лежит, и хранит всю информацию о вещах, чтобы человек не держал всё в голове.

Тон (tone of voice):
— дружелюбный, но без панибратства;
— понятный, без сложного техножаргона;
— лёгкий юмор в подсказках и второстепенных местах;
— важные сообщения (гарантии, срок годности, ошибки) — чётко и серьёзно.

Примеры фраз интерфейса:
— "Привет! Я — ГдеМоё. Давай наведём порядок в вещах, чтобы больше не искать их по полчаса."
— "Сфотографируй шкаф — я помогу вспомнить, что внутри."
— "ГдеМоё напоминает: гарантия на «Перфоратор Bosch» заканчивается через 7 дней."
— "Похоже, мы ещё не добавляли эту вещь. Хочешь создать карточку?"
Все тексты онбординга, подсказок и уведомлений делай в этом стиле.

ЧАСТЬ 3. ПЛАТФОРМА И КЛИЕНТСКИЙ СТЕК

Целевая платформа: Android.

Целевое устройство для ориентира: Samsung Galaxy S23 Ultra 256 Gb.

Стек клиента:
— язык: Kotlin;
— UI: Jetpack Compose;
— архитектура: MVVM / Clean Architecture;
— локальное кэширование: Room (SQLite).

Поддержка светлой и тёмной темы, адаптивный UI, но оптимизация под флагман.

ЧАСТЬ 4. BACKEND, NAS И БАЗА ДАННЫХ

NAS:
— модель: Terramaster F2-212;
— доступен по адресу (через интернет): https://enikeev.eu.link/tos/#/
;
— свободно около 17 ТБ.

Backend:
— язык: Python;
— фреймворк: FastAPI;
— база данных: PostgreSQL;
— желательно предусмотреть компиляцию Python-кода в исполняемый артефакт (например, Nuitka или PyInstaller) там, где это имеет смысл, но основной упор — на Docker-контейнеризацию.

Твои задачи по backend:
— создать структуру проекта FastAPI (каталоги, файлы, main-приложение, роутеры, модели, схемы pydantic);
— спроектировать и описать схему БД PostgreSQL:
— таблицы для пользователей, областей доступа (частная/публичная/групповая),
— таблицы для карточек предметов,
— таблицы для тегов и связей,
— таблицы для местоположений и их иерархии,
— таблицы для медиафайлов (фото, видео, документы),
— таблицы для групп карточек и иерархий,
— таблицы истории изменений (логов),
— таблицы задач/дел (todo),
— таблицы для ИИ-анализов и распознанных объектов.
— подготовить миграции (например, Alembic) или их аналог;
— подготовить Dockerfile для backend-сервиса;
— подготовить docker-compose.yaml для:
— сервиса FastAPI;
— PostgreSQL;
— (опционально) Redis или другого кэша;
— описать, как эти контейнеры будут использовать хранилище NAS для сохранения файлов (фото, видео, документов).

Инструкции для меня:
— ты должен подготовить текстовый файл-инструкцию (например, docs/backend_deploy_on_nas.md), в котором:
— описать, какие шаги я должен сделать на NAS Terramaster F2-212;
— какие пакеты/контейнеры установить;
— как скопировать твой код backend на NAS;
— как выполнить docker-compose up;
— как проверить, что сервис запущен;
— как настроить базу PostgreSQL (первичный пользователь, миграции).

ЧАСТЬ 5. МОДЕЛЬ ДАННЫХ: КАРТОЧКА ПРЕДМЕТА

Основная сущность: карточка предмета.

Минимальные поля:
— id;
— название;
— краткое описание;
— категория (тип предмета);
— теги (через отдельную таблицу и связь many-to-many);
— статус (enum);
— список фото и видео (ссылки на таблицу медиа);
— список текстовых заметок;
— модель, серийный номер, характеристики (желательно хранить в структуре JSONB или отдельной таблице параметров);
— дата покупки;
— цена и валюта;
— магазин/продавец;
— номер заказа;
— ссылка на интернет-магазин;
— ссылка на медиа-файлы чека (фото/pdf);
— дата окончания гарантии;
— срок годности (если есть);
— флаг/настройки напоминаний;
— привязка к местоположению;
— привязка к группам;
— привязка к области доступа (частная/публичная/групповая);
— ссылки на историю изменений.

Статусы карточки:
— Новый
— В порядке
— Сломан
— Потерян
— Отремонтирован
— Продан
— Выкинут
— Хочу купить
— В пути
— Надо проверить (отдельный статус для карточек, созданных автоматически по результатам анализа фото/видео)

Сделай в БД и в коде enum или справочник с этими статусами, с возможностью расширения в будущем.

ЧАСТЬ 6. ИЕРАРХИЯ МЕСТОПОЛОЖЕНИЙ

Нужно реализовать структуру местоположений с произвольной вложенностью, пример:
— Дом / Объект
— Квартира 1
— Комната 1
— Шкаф 1
— Полка
— Ящик
— Коробка
— Квартира 2
— Дача
— Сарай
— Гараж

Требования:
— можно вести несколько домов/объектов (квартира, дача, офис и т. д.);
— глубина вложенности не фиксирована, но типовые уровни — дом, квартира, комната, шкаф, полка, ящик, коробка;
— карточка может быть привязана одновременно к конкретным узлам (дом, квартира, комната, шкаф, ящик, коробка);
— нужна возможность перепривязывать местоположение и сохранять историю перемещений;
— backend должен предоставлять API:
— создание/редактирование/удаление узлов местоположений;
— получение дерева местоположений;
— выборка всех карточек в поддереве.

ЧАСТЬ 7. ИЕРАРХИИ КАРТОЧЕК И ГРУППЫ

Иерархия карточек:
— одна карточка может быть родительской для других карточек (наборы, комплекты);
— одна карточка может входить в несколько иерархий одновременно;
— реализуй таблицу связей parent_item_id / child_item_id.

Группы карточек:
— сущность "группа карточек" (логическая коллекция: "Инструменты для дачи", "Фотооборудование");
— у групп может быть своя иерархия (группа внутри группы);
— у групп могут быть собственные теги, заметки, настройки;
— карточка может входить в несколько групп.

ЧАСТЬ 8. ТЕГИ

Реализовать систему тегов:
— отдельная таблица tags;
— таблица связей card_tags;
— поддержка автодополнения часто используемых тегов.

По тегам должен работать быстрый поиск и фильтрация.

ЧАСТЬ 9. МЕДИА И ЗАМЕТКИ

Для каждой карточки:
— можно прикреплять фото;
— можно прикреплять видео;
— можно прикреплять текстовые заметки;
— в будущем — pdf и другие документы (предусмотри совместимость в модели данных).

Физическое хранение:
— файлы лежат на NAS;
— backend хранит пути/URL к этим файлам в БД;
— продумай структуру каталогов на NAS (по пользователям, коллекциям, карточкам).

Клиент:
— умеет загружать фото и видео на NAS через backend;
— умеет показывать миниатюры и полноразмерные версии;
— умеет показывать связи медиа ↔ карточки ↔ местоположения.

ЧАСТЬ 10. ИСТОРИЯ ИЗМЕНЕНИЙ

Для каждой карточки — хранить историю:
— дата и время создания;
— изменения статусов;
— изменения местоположений;
— изменения важных параметров (цена, гарантия и т. д.);
— пользователь, который внёс изменения (для групповых коллекций).

Сделать таблицу логов/истории и API для получения "таймлайна" событий по карточке.

ЧАСТЬ 11. ПОИСК И ФИЛЬТРАЦИЯ

Реализовать гибкий поиск и фильтрацию:

По местоположению:
— конкретный узел;
— всё поддерево.

По тексту:
— названия, описания, заметки, поля параметров.

По тегам.

По статусу.

По группам.

По параметрам:
— цена (диапазон);
— дата покупки (диапазон);
— дата окончания гарантии и сроков годности;
— категории.

По фото:
— пользователь даёт фото вещи — приложение ищет похожие/соответствующие карточки (с помощью ИИ-модуля).

В PostgreSQL продумай индексы и при необходимости механизмы полнотекстового поиска.

ЧАСТЬ 12. АВТОРИЗАЦИЯ И ОБЛАСТИ ДОСТУПА

Авторизация:
— при первом запуске приложение запрашивает у пользователя учётные данные к NAS (логин/пароль или иные данные);
— backend осуществляет проверку и выдает токен;
— токен хранится на устройстве безопасно (Keystore / EncryptedSharedPreferences);
— возможность сменить данные для NAS и аккаунт.

Области ведения карточек:
— частная (личная, доступ только владельцу, хранение в приватных папках NAS);
— публичная (доступна всем, хранится в публичной области NAS, минимум read-only для гостей);
— групповая (семейная), с несколькими пользователями и ролями:
— владелец,
— редактор,
— читатель.

Нужны сущности users, groups, memberships, permissions.

ЧАСТЬ 13. КЛЮЧЕВАЯ ИИ-ФУНКЦИЯ: АНАЛИЗ ФОТО/ВИДЕО

Сценарий:
— пользователь делает фото или видео содержимого шкафов, ящиков, кладовок через приложение или выбирает из галереи;
— приложение отправляет медиа на backend;
— backend сохраняет файл на NAS;
— в фоне backend вызывает ИИ-модуль для анализа:
— распознаёт объекты (вещи) на фото/видео;
— пытается сопоставить их с существующими карточками (по образу, названию, параметрам);
— если подходящих карточек нет — создаёт новые карточки со статусом "Надо проверить".

Связи:
— каждое фото/видео может быть связано с одной или несколькими карточками;
— у медиа может быть привязано местоположение;
— карточка показывает список медиа, с которыми она связана;
— местоположение показывает медиа, связанные с ним.

Автоматическая привязка:
— если по фото/видео определены и карточка, и местоположение, карточка автоматически привязывается к этому местоположению.

Редактирование:
— пользователь может добавлять и удалять связи медиа ↔ карточки;
— может изменять местоположение, связанное с медиа;
— может подтверждать или исправлять созданные карточки со статусом "Надо проверить".

Архитектура ИИ:
— спроектировать отдельный модуль или сервис (может быть отдельный контур в backend или внешний сервис), который:
— принимает ссылки на медиа;
— возвращает список распознанных объектов и вероятности;
— предлагает сопоставления с существующими карточками.
— описать формат API запросов и ответов для интеграции FastAPI с ИИ-модулем;
— реализовать прототип интерфейса взаимодействия (классы, роуты, схемы).

ЧАСТЬ 14. ЖЕЛАТЕЛЬНЫЕ ФУНКЦИИ

По возможности реализуй, как минимум — спроектируй:

Сбор информации о товаре из интернета:
— по названию, модели, штрихкоду.

Сбор информации по фото:
— извлечение модели и серийного номера с шильдиков, этикеток, коробок.

Функции заметочника (как Evernote):
— текстовые заметки;
— заметки с фото и файлами;
— теги;
— поиск по заметкам;
— привязка заметок к карточкам и местам.

Импорт карточек из CSV:
— формат CSV с колонками (название, описание, теги, статус, местоположение, группы и т. д.);
— реализация импорта на backend с проверками и отчётом.

Экспорт в CSV:
— по фильтрам (по домам, группам, тегам и т. д.).

Интеграция информации о покупках:
— из почты (парсинг писем о заказах);
— из интернет-магазинов (Озон, Wildberries, Яндекс Маркет) через письма или API;
— по фото чека (распознавание текста);
— по фото товара, коробки, документации (бренд, модель, серийный номер).

Поиск товаров по фото в интернете:
— для уточнения модели и характеристик.

Списки дел (to-do):
— "купить", "починить", "выкинуть" и т. д.;
— задачи привязываются к карточкам и местам.

Основные функции Evernote внутри экосистемы "ГдеМоё":
— заметки;
— блокноты или разделы;
— теги;
— привязка к вещам и местам.

ЧАСТЬ 15. РАСШИРЯЕМОСТЬ И БУДУЩЕЕ

При проектировании архитектуры учти:

Возможность добавления других источников хранения помимо NAS (облачные хранилища и т. д.).

Возможность расширения типов вложений (pdf, документы).

Подготовку к многопользовательской коммерческой эксплуатации:
— разные рабочие пространства (workspaces);
— платные тарифы и подписки;
— ограничения по функциям для разных планов.

ЧАСТЬ 16. СБОРКА, КОМПИЛЯЦИЯ, ДЕПЛОЙ И ИНСТРУКЦИИ

Backend:
— создай Dockerfile и docker-compose для запуска FastAPI и PostgreSQL;
— подготовь инструкции по шагам:
— как собрать Docker-образ;
— как запустить docker-compose;
— какие переменные окружения задать (например, в .env-файле);
— как применить миграции БД;
— как проверить доступ к API (пример curl-запросов).
— опиши, как при необходимости скомпилировать Python-код (например, с помощью Nuitka или PyInstaller), если будет использоваться такой сценарий (опиши команду, входные файлы, выходной бинарник).

Android-приложение:
— создай структуру Android-проекта (Gradle, build.gradle, AndroidManifest, пакеты);
— реализуй основные экраны:
— онбординг с брендингом "ГдеМоё — приложение, которое помнит за вас.";
— список вещей;
— экран карточки вещи;
— поиск и фильтры;
— дерево местоположений;
— экран привязки медиа;
— экран "Надо проверить" (автоматические карточки);
— настройки подключения к NAS и аккаунту.
— подготовь инструкции:
— какие команды Gradle нужно выполнить для сборки релизного APK;
— в каком каталоге появится APK;
— как установить его на Android-устройство (например, через adb install).

Максимальная автоматизация:
— все скрипты сборки (backend, Android) сохрани в проекте;
— опиши в отдельном текстовом файле (например, docs/build_and_run.md) полный сценарий:
— клонирование или копирование проекта;
— запуск backend (локально и на NAS);
— сборка APK;
— первый запуск приложения и проверка соединения с backend.

ИТОГО

Используй весь этот текст как единый промпт и техническое задание. Твоя цель — максимально самостоятельно:
— спроектировать архитектуру;
— написать код backend (FastAPI + PostgreSQL + Python);
— написать код Android-приложения (Kotlin + Jetpack Compose + MVVM);
— подготовить структуру файлов и каталогов;
— создать Docker-окружение для backend;
— подготовить команды и инструкции для сборки и деплоя;
— задать все необходимые тексты интерфейса с учётом названия "ГдеМоё" и слогана "ГдеМоё — приложение, которое помнит за вас.".

Если какой-то шаг ты не можешь выполнить сам в своей среде, ты обязан максимально подробно описать, что именно должен сделать пользователь (я): какие команды выполнить, в каком порядке, где и какие файлы должны быть до и после выполнения.

По этому заданию сделано не большое MVP.
По последним изменения:
Версия обновилась.
Пришёл успешный статус, что карточка создана.
Стал обновляться статус ИИ.
Статус ИИ всегда с ошибкой, нужно разобраться почему и исправить.
Видео не отправляется, нужно исправить.
Иногда вылетает мобильное приложение, нужно исправить.
Надо чтобы при добавлении фото и видео должна быть возможно фотографировать или записывать видео с камеры.

Используй и дополняй документацию в директории "docs", например:
1. task.md
2. architecture.md
3. ux_ui_task.md
4. ux_ui_koncept.md
5. ux_ui_low-fidelity.md
6. ux_ui_status.md
7. data_model.md
8. ai_integration.md
9. backend_deploy_on_nas.md
10. build_and_run.md
11. changes.md
12. defects.md
